<!DOCTYPE html>
<html>
<head>
    <title>Test Debug</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #f0f0f0; }
        .error { background: #ffebee; padding: 15px; border-left: 4px solid #f44336; margin: 10px 0; }
        .success { background: #e8f5e9; padding: 15px; border-left: 4px solid #4caf50; margin: 10px 0; }
        .info { background: #e3f2fd; padding: 15px; border-left: 4px solid #2196f3; margin: 10px 0; }
        pre { background: white; padding: 10px; overflow-x: auto; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>Test API Debug Tool</h1>
    <div id="output"></div>

    <script>
        const output = document.getElementById('output');
        const urlParams = new URLSearchParams(window.location.search);
        const userTestId = urlParams.get('user_test_id') || '6';
        const token = sessionStorage.getItem('halyk_token');

        async function testAPI() {
            output.innerHTML += `<div class="info">Testing with user_test_id: ${userTestId}</div>`;
            output.innerHTML += `<div class="info">Token: ${token ? 'Found ✓' : 'Missing ✗'}</div>`;

            if (!token) {
                output.innerHTML += `<div class="error">No token found! Please login first.</div>`;
                return;
            }

            try {
                output.innerHTML += `<div class="info">Calling: GET /api/test/${userTestId}/questions</div>`;
                
                const response = await fetch(`/api/test/${userTestId}/questions`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                output.innerHTML += `<div class="info">Response status: ${response.status}</div>`;

                const text = await response.text();
                output.innerHTML += `<div class="info">Response body:</div>`;
                output.innerHTML += `<pre>${text}</pre>`;

                if (response.ok) {
                    const data = JSON.parse(text);
                    output.innerHTML += `<div class="success">SUCCESS! Got ${data.questions?.length || 0} questions</div>`;
                } else {
                    output.innerHTML += `<div class="error">FAILED! Status ${response.status}</div>`;
                }
            } catch (error) {
                output.innerHTML += `<div class="error">ERROR: ${error.message}</div>`;
                output.innerHTML += `<pre>${error.stack}</pre>`;
            }
        }

        // Auto-run on load
        testAPI();
    </script>
</body>
</html>
